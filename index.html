<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Impress by tshemsedinov</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Impress</h1>
        <h2>Impressive totalitarian-style Application Server for node.js. All decisions are made. Ready for applied development.</h2>
        <a href="https://github.com/tshemsedinov/impress" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p><img src="http://habrastorage.org/storage2/c1e/1b7/190/c1e1b7190c8c6685a34d6584e936c4c9.png" alt="impress logo"></p>

<h1>
<a name="impress" class="anchor" href="#impress"><span class="octicon octicon-link"></span></a>Impress</h1>

<p><a href="https://github.com/tshemsedinov/impress.git">Impress</a>ive totalitarian-style Application Server for <a href="http://nodejs.org">node.js</a>. All decisions are made. Ready for applied development.</p>

<p>The main difference from others that Impress core is monolithic and its approach is to make all in one solution with high code coupling for obligatory things and leave not obligatory to be integrated by applied developers optionally. High coupling in core gives us advantages in performance and code simplicity. For example, why we should implement static files serving or memory caching as a plugin while no one application will omit that.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>npm install impress
</pre></div>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Can serve multiple applications and sites on multiple domains</li>
<li>Serves multiple ports, network interfaces, hosts and protocols</li>
<li>Can be run on one or multiple servers</li>
<li>Supports one or multiple CPU cores with following instantiation strategies:

<ul>
<li>Single instance (one process)</li>
<li>Instance specialization (multiple processes, one master and different workers for each server)</li>
<li>Multiple instances (multiple processes, one master and identical workers with no sticky)</li>
<li>IP sticky (multiple processes, one master and workers with serving sticky by IP)</li>
</ul>
</li>
<li>URL routing based on file system

<ul>
<li>Caching server-side executable JavaScript in memory</li>
<li>Filesystem watching for cache reloading when file changes on disk</li>
</ul>
</li>
<li>API development support (simple way for JSON-based WEB-services development)

<ul>
<li>RPC-style API (Stateful, state stored in memory between requests)</li>
<li>REST-style API (Stateless, each call is separate, no state in memory)</li>
</ul>
</li>
<li>Server server-side templating

<ul>
<li>Caching templates in memory and ready (rendered) pages optional caching</li>
<li>Value rendering with @VariableName@ syntax, absolute and relative addressing</li>
<li>Array and hash iterations with @[arrayName]@ and @[/arrayName]@ syntax</li>
<li>Including sub-templates @[includeTemplate]@ syntax</li>
<li>Template personalization for user groups</li>
</ul>
</li>
<li>Config changes with zero downtime

<ul>
<li>Flexible configuration in JSON file</li>
<li>File watch and automatic soft reloading when config.js file changes</li>
<li>No Impress server hard restarting</li>
</ul>
</li>
<li>Serving static files

<ul>
<li>Gzipping and HTTP request field "if-modified-since" field support and HTTP 304 "Not Modified" answer</li>
<li>Memory caching and filesystem watching for cache reloading when files changed on disk</li>
<li>JavaScript optional (configurable) minification, based on module "uglify-js" as Impress plugin</li>
</ul>
</li>
<li>Built-in sessions support with authentication and user groups and anonymous sessions

<ul>
<li>Sessions and cookies (memory state or persistent sessions with MongoDB)</li>
<li>Access modifiers for each folder in access.js files and access inheritance</li>
</ul>
</li>
<li>Implemented SSE (Server-Sent Events) with channels and multicast</li>
<li>Reverse-proxy (routing request to external HTTP server with URL-rewriting)</li>
<li>Logging: "access", "debug", "error and "slow" logs

<ul>
<li>Log rotation: keep logs N days (configurable) delete files after N days</li>
<li>Log buffering, write stream flushing interval</li>
</ul>
</li>
<li>Connection drivers for database engines:

<ul>
<li>MySQL data access layer based on felixge/mysql low-level drivers (separate module "musql-utilities")

<ul>
<li>MySQL Data Access Methods: queryRow, queryValue, queryCol, queryHash, queryKeyValue</li>
<li>MySQL Introspection Methods: primary, foreign, constraints, fields, databases, tables, databaseTables, tableInfo, indexes, processes, globalVariables, globalStatus, users</li>
<li>MySQL SQL Autogenerating Methods: select, insert, update, upsert, count, delete</li>
<li>Events: 'query', 'slow'</li>
</ul>
</li>
<li>MongoDB drivers as Impress plugin</li>
<li>Memcached drivers as Impress plugin</li>
<li>MySQL schema generator from JSON database schemas</li>
</ul>
</li>
<li>Sending Emails functionality using "nodemailer" module as Impress plugin</li>
<li>IPC support (interprocess communications) for event delivery between Node.js instances</li>
<li>Integrated DBMI (Web-based management interface for MySQL and MongoDB)</li>
<li>GeoIP support, based on "geoip-lite" module as Impress plugin (uses MaxMind database)</li>
</ul><h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<ol>
<li>Install module using npm</li>
<li>Edit config.js file in project folder (or leave it untouched if you want just to test Impress)</li>
<li>If you want to store persistent sessions in MongoDB you need this DBMS installed and you need to run "node setup.js" before starting Impress</li>
<li>Run Impress using command "node server.js"</li>
</ol><h2>
<a name="handler-examples-and-file-system-url-mapping" class="anchor" href="#handler-examples-and-file-system-url-mapping"><span class="octicon octicon-link"></span></a>Handler examples and file system url mapping</h2>

<ol>
<li>Template example
Location: http://localhost
Base template: /sites/localhost/html.template</li>
<li>Override included "left.template"
Location: http://localhost/override
Overriden template: /sites/localhost/override/left.template
Base template: /sites/localhost/html.template
Handler: /sites/localhost/request.js</li>
<li>JSON api method example
Location: http://localhost/api/examples/methodName.json
Handler: /sites/localhost/api/examples/methodName.json/get.js</li>
<li>Start anonymous session
Location: http://localhost/api/auth/anonymousSession.json
Handler: /sites/localhost/api/auth/anonymousSession.json/get.js</li>
<li>POST request handler
Location: POST http://localhost/api/auth/regvalidation.json
Handler: /sites/localhost/api/auth/regvalidation.json/post.js</li>
<li>MongoDB access example
Location: http://localhost/api/examples/getUsers.json
Handler: /sites/localhost/api/examples/getUsers.json/get.js</li>
</ol><h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<p>Following "server.js" is stating file. Run it using command line "node server" for debug or "nohup node server" for production.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">require</span><span class="p">(</span><span class="s1">'impress'</span><span class="p">);</span>
<span class="nx">impress</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Place here other initialization code</span>
    <span class="c1">// to be executed after Impress initialization</span>
<span class="p">});</span>
</pre></div>

<p>File "access.js" is something line ".htaccess", you can easily define access restrictions for each folder, placing "access.js" in it.
If folder not contains "access.js" it will inherit from parent folder and so on. Example:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">guests</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// allow requests from not logged users</span>
    <span class="nx">logged</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// allow requests from logged users</span>
    <span class="nx">http</span><span class="o">:</span>   <span class="kc">true</span><span class="p">,</span> <span class="c1">// allow requests using http protocol</span>
    <span class="nx">https</span><span class="o">:</span>  <span class="kc">true</span><span class="p">,</span> <span class="c1">// allow requests using https protocol (SSL)</span>
    <span class="nx">groups</span><span class="o">:</span> <span class="p">[]</span>    <span class="c1">// allow access for user groups listed in array</span>
                  <span class="c1">// or for all if array is empty or no groups field specified</span>
<span class="p">}</span>
</pre></div>

<p>File "request.js": place such file in folder to be executed on each request (GET, POST, PUT, etc.).
If folder not contains "request.js" it will inherit from parent folder and so on. Example:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">"Page Title"</span><span class="p">,</span>
        <span class="nx">users</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="s2">"vasia"</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">22</span><span class="p">,</span>
                <span class="nx">emails</span><span class="o">:</span> <span class="p">[</span><span class="s2">"user1@gmail.com"</span><span class="p">,</span> <span class="s2">"user2@gmail.com"</span><span class="p">]</span>
            <span class="p">},{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="s2">"dima"</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="nx">emails</span><span class="o">:</span> <span class="p">[</span><span class="s2">"user3@gmail.com"</span><span class="p">,</span> <span class="s2">"user4@gmail.com"</span><span class="p">,</span> <span class="s2">"user5@gmail.com"</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">session</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">impress</span><span class="p">.</span><span class="nx">sessions</span><span class="p">[</span><span class="nx">req</span><span class="p">.</span><span class="nx">impress</span><span class="p">.</span><span class="nx">session</span><span class="p">])</span>
    <span class="p">};</span>
    <span class="nx">callback</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>File "get.js": place such file in folder to be executed on GET request. For POST request "post.js", and so on.
If folder not contains "get.js" it will inherit from parent folder and so on. Example:</p>

<div class="highlight highlight-javascript"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">polltool</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">'select * from City'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">rows</span><span class="o">:</span><span class="nx">rows</span><span class="p">,</span> <span class="nx">fields</span><span class="o">:</span><span class="nx">fields</span> <span class="p">};</span>
        <span class="nx">callback</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>File "html.template": place such file in folder as a main page template. Example:</p>

<div class="highlight highlight-html"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>@title@<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        Field value: @field@
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        Include template: @[name]@ - this will include file "./name.template"
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        This will iterate "res.context.data" from "request.js" example above:
        @[users]@
            <span class="nt">&lt;div&gt;</span>
                User name: @.name@<span class="nt">&lt;br/&gt;</span>
                User age: @.age@<span class="nt">&lt;br/&gt;</span>
                Email addresses:
                <span class="nt">&lt;ul&gt;</span>
                    @[emails]@
                        <span class="nt">&lt;li&gt;</span>@.value@<span class="nt">&lt;/li&gt;</span>
                    @[/emails]@
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        @[/users]@
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<h2>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h2>

<ul>
<li>Timur Shemsedinov (marcusaurelius)</li>
<li>Sergey Andriyaschenko (tblasv)</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Dual licensed under the MIT or RUMI licenses.</p>

<p>Copyright (c) 2012-2013 MetaSystems &lt;<a href="mailto:timur.shemsedinov@gmail.com">timur.shemsedinov@gmail.com</a>&gt;</p>

<p>License: RUMI</p>

<p>Do you know what you are?
You are a manuscript of a divine letter.
You are a mirror reflecting a noble face.
This universe is not outside of you.
Look inside yourself;
everything that you want,
you are already that.</p>

<p>Jalal ad-Din Muhammad Rumi
"Hush, Don't Say Anything to God: Passionate Poems of Rumi"</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/tshemsedinov/impress/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/tshemsedinov/impress/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/tshemsedinov/impress"></a> is maintained by <a href="https://github.com/tshemsedinov">tshemsedinov</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>